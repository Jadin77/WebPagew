<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roblox Tweaks - Free Scripts</title>
    <script src="theme.js"></script>
    <script src="ui-sounds.js"></script>
    <script src="site-ui.js"></script>
    <style>
      :root {
        --bg1: #0b1f3a;
        --bg2: #0f3b5f;
        --accent: #ff7a00;
        --accent-2: #21d4fd;
        --accent-3: #7cff6b;
        --accent-4: #ff5ea8;
        --glow1: rgba(22, 58, 99, 0.9);
        --glow2: rgba(29, 75, 122, 0.9);
        --text: #f5f7fb;
        --muted: #c7d2e0;
        --card: rgba(8, 18, 32, 0.7);
        --border: rgba(255, 255, 255, 0.08);
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: var(--text);
        background: radial-gradient(1200px 600px at 20% 10%, var(--glow1) 0%, transparent 60%),
                    radial-gradient(900px 500px at 80% 20%, var(--glow2) 0%, transparent 55%),
                    linear-gradient(160deg, var(--bg1), var(--bg2));
      }
      header {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(8px);
        background: rgba(6, 14, 26, 0.7);
        border-bottom: 1px solid var(--border);
      }
      .nav {
        max-width: 1100px;
        margin: 0 auto;
        padding: 14px 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      .brand {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 42px;
        height: 42px;
        border-radius: 10px;
        background: rgba(255,255,255,0.08);
        border: 1px solid var(--border);
        margin-right: 6px;
        overflow: hidden;
        font-size: 12px;
        font-weight: 700;
      }
      .brand img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .nav a {
        color: var(--text);
        text-decoration: none;
        padding: 8px 12px;
        border-radius: 999px;
        border: 1px solid transparent;
        font-size: 14px;
        font-weight: 600;
      }
      .nav a:hover {
        border-color: var(--border);
        background: rgba(255,255,255,0.04);
      }
      .nav a.active {
        border-color: rgba(255,255,255,0.55);
        box-shadow: 0 0 0 1px rgba(255,255,255,0.22) inset;
        background: rgba(255,255,255,0.22);
      }
      .tab-home { background: rgba(83, 227, 255, 0.26); }
      .tab-scripts { background: rgba(255, 140, 77, 0.28); }
      .tab-studio { background: rgba(145, 255, 120, 0.28); }
      .tab-programs { background: rgba(255, 126, 190, 0.26); }
      .tab-socials { background: rgba(255, 255, 255, 0.16); }
      .tab-free { background: rgba(126, 245, 255, 0.26); }
      .tab-settings { background: rgba(0,0,0,0.32); }
      .tab-help { background: rgba(255, 214, 92, 0.28); }
      .settings-trigger { cursor: pointer; }
      .nav .spacer { flex: 1; }
      .btn {
        text-decoration: none;
        color: #111;
        background: var(--accent);
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 600;
      }
      
      .tab-shop {
        background: linear-gradient(135deg, rgba(102,255,156,0.34), rgba(43,220,126,0.34));
      }
      .btn.ghost {
        background: transparent;
        color: var(--text);
        border: 1px solid rgba(255,255,255,0.2);
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 40px 20px 80px;
      }
      .hero {
        padding: 32px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      }
      .hero h1 { margin: 0 0 8px; }
      .hero p { margin: 0; color: var(--muted); }
      .hero-title {
        font-size: clamp(32px, 5vw, 46px);
        letter-spacing: 0.02em;
        text-shadow: 0 0 14px rgba(126, 245, 255, 0.45), 0 0 28px rgba(255, 122, 0, 0.22);
      }
      .hero-sub {
        margin-top: 10px;
        line-height: 1.6;
      }
      .hero-sub strong {
        color: #f4fbff;
      }
      .hero-actions {
        margin-top: 14px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .discord-cta {
        border: 1px solid rgba(126,245,255,0.45);
        background: linear-gradient(180deg, rgba(126,245,255,0.24), rgba(126,245,255,0.1));
        color: #ecfbff;
      }
      .discord-tag {
        color: var(--muted);
        font-size: 13px;
        align-self: center;
      }

      .ad-slot {
        margin: 18px 0 8px;
        padding: 12px;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.2);
        border-radius: 12px;
      }

      .scroll-area {
        margin-top: 22px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
      }
      .card {
        padding: 20px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        transition: transform 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
      }
      .card-link {
        display: block;
        text-decoration: none;
        color: inherit;
      }
      .card:hover {
        transform: translateY(-3px);
        border-color: rgba(33, 212, 253, 0.45);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.28);
      }
      .thumb {
        width: 100%;
        height: 150px;
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(33,212,253,0.35), rgba(255,122,0,0.25));
        border: 1px dashed rgba(255,255,255,0.2);
        display: grid;
        place-items: center;
        color: var(--muted);
        font-size: 14px;
      }
      .card h3 {
        margin: 14px 0 8px;
        font-size: 18px;
      }
      .card p {
        margin: 0 0 14px;
        color: var(--muted);
        font-size: 14px;
        line-height: 1.5;
      }
      .card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.05);
      }
      .thumb-wrap {
        position: relative;
      }
      .view-chip {
        position: absolute;
        top: 8px;
        left: 8px;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(6, 14, 26, 0.78);
        border: 1px solid rgba(255,255,255,0.25);
        color: #f2f7ff;
        font-size: 12px;
        font-family: "Trebuchet MS", "Segoe UI", Tahoma, sans-serif;
      }
      .status {
        color: var(--muted);
        font-size: 14px;
        margin: 4px 0 12px;
      }
      .filter-row {
        display: flex;
        justify-content: flex-start;
        margin: 6px 0 10px;
      }
      .filter-tabs {
        display: flex;
        gap: 10px;
        margin: 0;
        flex-wrap: wrap;
      }
      .exclude-row {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 10px;
        margin: 0 0 14px;
        flex-wrap: wrap;
      }
      .keyword-toggle-bar {
        display: flex;
        gap: 8px;
        margin: 0;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .keyword-toggle {
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.16);
        background: transparent;
        backdrop-filter: blur(6px);
        color: var(--text);
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        letter-spacing: 0.015em;
        transition: transform 0.16s ease, border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
      }
      .keyword-toggle:hover {
        transform: translateY(-1px);
        border-color: rgba(255,255,255,0.3);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
        background: rgba(255,255,255,0.05);
      }
      .keyword-toggle.active {
        border-color: rgba(255, 148, 94, 0.62);
        background: linear-gradient(180deg, rgba(255, 148, 94, 0.22), rgba(255, 94, 94, 0.14));
        box-shadow: 0 0 0 1px rgba(255, 148, 94, 0.2) inset, 0 0 14px rgba(255, 148, 94, 0.18);
      }
      .toggle-icon {
        margin-right: 6px;
        opacity: 0.9;
      }
      .toggle-mark {
        margin-right: 6px;
        color: #ffd8bf;
      }
      .accent-hub {
        color: #ff9b57;
      }
      .search-wrap {
        margin: 0 0 12px;
      }
      .search-input {
        width: 100%;
        padding: 11px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.08);
        color: var(--text);
        outline: none;
      }
      .search-input::placeholder {
        color: #c9d4e3;
      }
      .filter-tab {
        padding: 8px 13px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.14);
        background: linear-gradient(180deg, rgba(126,245,255,0.08), rgba(255,255,255,0.03));
        backdrop-filter: blur(6px);
        color: var(--text);
        cursor: pointer;
        font-weight: 500;
        letter-spacing: 0.015em;
        transition: transform 0.16s ease, border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
      }
      .filter-tab:hover {
        transform: translateY(-1px);
        border-color: rgba(255,255,255,0.26);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.22);
        background: linear-gradient(180deg, rgba(255,255,255,0.13), rgba(255,255,255,0.06));
      }
      .filter-tab.active {
        border-color: rgba(126,245,255,0.58);
        background: linear-gradient(180deg, rgba(126,245,255,0.28), rgba(126,245,255,0.14));
        box-shadow: 0 0 0 1px rgba(126,245,255,0.2) inset, 0 0 16px rgba(126,245,255,0.2);
      }
      .meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        margin: 0 0 12px;
        color: var(--muted);
        font-size: 12px;
      }
      .author {
        color: #dbe8f9;
        font-weight: 600;
      }
      .trusted-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 999px;
        background: rgba(124,255,107,0.25);
        border: 1px solid rgba(124,255,107,0.5);
        color: #d8ffd0;
        font-weight: 700;
        font-size: 11px;
      }
      .post-time {
        color: #b7c5d8;
        font-size: 12px;
        letter-spacing: 0.01em;
        font-weight: 700;
      }
      .trusted-user-card {
        display: block;
        text-decoration: none;
        color: inherit;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 14px;
        transition: transform 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
      }
      .trusted-user-card:hover {
        transform: translateY(-2px);
        border-color: rgba(126,245,255,0.55);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.28);
      }
      .trusted-user-head {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .trusted-user-pfp {
        width: 56px;
        height: 56px;
        border-radius: 999px;
        object-fit: cover;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.08);
      }
      .trusted-user-name {
        margin: 0;
        font-size: 16px;
        font-weight: 700;
      }
      .trusted-user-sub {
        margin: 4px 0 0;
        color: var(--muted);
        font-size: 12px;
      }
      .stats {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin: 0 0 12px;
        color: var(--muted);
        font-size: 12px;
      }
      .pager {
        margin-top: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      .pager button {
        padding: 9px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.08);
        color: var(--text);
        cursor: pointer;
      }
      .pager button[disabled] {
        opacity: 0.45;
        cursor: not-allowed;
      }
      .page-text {
        color: var(--muted);
        font-size: 14px;
      }
      .page-jump {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 6px;
      }
      .page-jump input[type="range"] {
        width: min(360px, 90vw);
        accent-color: var(--accent-2);
      }
      .jump-input {
        width: 90px;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.08);
        color: var(--text);
      }
      footer {
        margin-top: 40px;
        color: var(--muted);
        font-size: 13px;
        text-align: center;
      }
      .settings-modal {
        position: fixed;
        inset: 0;
        background: rgba(3, 8, 18, 0.62);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 90;
        padding: 18px;
      }
      .settings-modal.open { display: flex; }
      .settings-panel {
        width: min(920px, 100%);
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 20px;
      }
      .settings-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }
      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 10px;
      }
      .theme-btn {
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        background: rgba(255,255,255,0.06);
        color: var(--text);
        cursor: pointer;
        text-align: left;
        padding: 0;
      }
      .theme-swatch { height: 54px; }
      .theme-name { padding: 8px 10px; font-weight: 700; font-size: 13px; }
      .theme-btn.active {
        border-color: rgba(124,255,107,0.6);
        box-shadow: 0 0 0 2px rgba(124,255,107,0.18) inset;
      }
      .sound-btn {
        border: 1px solid var(--border);
        border-radius: 12px;
        background: rgba(255,255,255,0.06);
        color: var(--text);
        cursor: pointer;
        text-align: left;
        padding: 10px 12px;
        font-weight: 600;
      }
      .sound-btn.active {
        border-color: rgba(126,245,255,0.65);
        box-shadow: 0 0 0 2px rgba(126,245,255,0.18) inset;
      }      .volume-wrap {
        margin-top: 10px;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: rgba(255,255,255,0.05);
      }
      .volume-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 6px;
        font-weight: 700;
      }
      .volume-head span:last-child {
        color: var(--muted);
        font-weight: 600;
      }
      .volume-slider {
        width: 100%;
        accent-color: var(--accent-2);
      }
      @media (max-width: 760px) {
        .nav {
          gap: 6px;
          padding: 10px 12px;
        }
        .nav a {
          padding: 7px 10px;
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="nav">
        <div class="brand">
          <img src="images/logo/Logo.svg" alt="Logo" onerror="this.style.display='none'; this.parentElement.textContent='RT';" />
        </div>
        <a class="tab-home" href="index.html">🏠 Home</a>
        <a class="tab-scripts" href="roblox-scripts.html">🧩 Roblox Scripts</a>
        <a class="tab-studio" href="roblox-studio.html">🛠 Roblox Studio</a>
        <a class="tab-programs" href="programs.html">💻 Programs</a>
        <a class="tab-socials" href="socials.html">🌐 Socials</a>
        <a class="tab-free active" href="free-scripts.html">🆓 Free Scripts</a>
        <a class="tab-settings settings-trigger" id="open-settings" href="#">⚙ Settings</a>
        <div class="spacer"></div>
        <a class="tab-help" id="open-help" href="#">❓ Help</a>
        <a class="tab-shop" href="https://shoppy.gg/@jadin77">🛒 Shop</a>
      </nav>
    </header>

    <main class="container">
      <section class="hero">
        <h1 class="hero-title">Free Scripts</h1>
        <p class="hero-sub">
          <strong>Powered by ScriptBlox.</strong> This website is a <strong>modded browsing layer</strong>, not a replacement.
          It is built for smoother discovery, safer filtering, and faster browsing between both platforms. We focus on
          recent, useful script visibility (about a week-plus active window), stronger anti-scam filtering, trusted/recommended
          surfacing, and cleaner category controls so you can move back and forth with less risk and less clutter.
        </p>
        <div class="hero-actions">
          <button id="copy-discord" class="btn discord-cta" type="button">DM for Trusted/Recommended Access</button>
          <span class="discord-tag">Discord: <strong>Jadin7380</strong></span>
        </div>
        <div class="ad-slot">
          
        </div>
        <script data-cfasync="false" src="//dcbbwymp1bhlf.cloudfront.net/?wbbcd=1243710"></script>
      </section>

      <div class="scroll-area">
        <p id="feed-status" class="status">Loading latest scripts and images...</p>
        <div class="search-wrap">
          <input id="search-input" class="search-input" type="text" placeholder="Search scripts by title or tags..." />
        </div>
        <div class="filter-row">
          <div class="filter-tabs">
            <button id="tab-all" class="filter-tab active" type="button">All Scripts</button>
            <button id="tab-recommend" class="filter-tab" type="button">Recommend Scripts</button>
            <button id="tab-trusted-users" class="filter-tab" type="button">Trusted</button>
            <button id="tab-trending" class="filter-tab" type="button">Trending</button>
          </div>
        </div>
        <div class="exclude-row">
          <div id="keyword-toggle-bar" class="keyword-toggle-bar"></div>
        </div>
        <div id="script-feed" class="grid"></div>
        <div class="pager">
          <button id="prev-page" type="button">Prev</button>
          <span id="page-text" class="page-text">Page 1 / 1</span>
          <button id="next-page" type="button">Next</button>
          <div id="page-jump" class="page-jump">
            <input id="page-slider" type="range" min="1" max="1" value="1" aria-label="Page slider">
            <input id="page-input" class="jump-input" type="number" min="1" value="1" aria-label="Page number">
            <button id="go-page" type="button">Go</button>
          </div>
        </div>
      </div>

      <footer>
        © 2026 Roblox Tweaks. All rights reserved.
      </footer>
    </main>
    <div id="settings-modal" class="settings-modal" aria-hidden="true">
      <section class="settings-panel">
        <div class="settings-head">
          <h2 style="margin:0;">Theme Settings</h2>
          <button id="close-settings" class="btn ghost" type="button">← Back</button>
        </div>
        <div id="theme-grid" class="settings-grid"></div>
        <h3 style="margin:14px 0 8px;">Sound Preset</h3>
        <div id="sound-grid" class="settings-grid"></div><div class="volume-wrap"><div class="volume-head"><span>🔊 Site Sounds</span><span id="sound-volume-value">50%</span></div><input id="sound-volume" class="volume-slider" type="range" min="0" max="100" step="1" value="50" aria-label="Website Volume"></div>
      </section>
    </div>
    <div id="help-modal" class="settings-modal" aria-hidden="true">
      <section class="settings-panel">
        <div class="settings-head">
          <h2 style="margin:0;">Help info</h2>
          <button id="close-help" class="btn ghost" type="button">Close</button>
        </div>
        <p style="margin:0; color:var(--muted); line-height:1.6;">
          If you need support, direct message and add me on Discord: <strong>Jadin7380</strong>
        </p>
      </section>
    </div>
    <script src="scriptblox-feed.js"></script>
    <script>
      let allScripts = [];
      let visibleScripts = [];
      let page = 1;
      const perPage = 24;
      const fallbackImage = "https://placehold.co/600x340/163a63/f5f7fb?text=Script";
      let loadingFeed = false;
      let filterMode = "all";
      let searchQuery = "";
      const seedTrustedUsers = ["IHeartCoding"];
      const localToggleStorageKey = "webpage_script_hide_toggles_v1";
      const localHidePresets = [
        { id: "drve", label: "No DRVE", tokens: ["drve"] },
        { id: "brainrot", label: "No Brainrot", tokens: ["brainrot", "steal", "grab"] },
        { id: "aimbot", label: "No Aimbot", tokens: ["aimbot", "aimlock"] },
        { id: "hubs", labelHtml: "No <span class=\"accent-hub\">Hub's</span>", tokens: ["hub", "hubs"] },
        { id: "junk", label: "No Junk", tokens: ["free", "dupe", "admin", "fake"] }
      ];
      let localHideState = {};

      function normalizeImageUrl(value) {
        if (typeof value !== "string") return "";
        const url = value.trim();
        if (!url) return "";
        if (url.startsWith("//")) return "https:" + url;
        if (url.startsWith("/")) return "https://scriptblox.com" + url;
        return url;
      }

      function resolveImage(script) {
        const candidates = [script?.image, script?.imageUrl, script?.game?.imageUrl, script?.game?.image];
        for (const c of candidates) {
          const url = normalizeImageUrl(c);
          if (url) return url;
        }
        return fallbackImage;
      }

      function escapeHtml(value) {
        return String(value)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function normalizeText(value) {
        return String(value || "").toLowerCase().replace(/[^a-z0-9]+/g, "");
      }

      function resolveOwnerUsername(script) {
        const raw = String(script?.ownerUsername || script?.owner?.username || script?.owner || "").trim();
        if (!raw) return "";
        const lower = raw.toLowerCase();
        if (lower === "unknown" || lower === "@unknown" || lower === "n/a" || lower === "null") return "";
        return raw;
      }

      function formatPostTime(value) {
        if (!value) return "";
        const d = new Date(value);
        if (Number.isNaN(d.getTime())) return "";
        const now = Date.now();
        const diffMs = now - d.getTime();
        if (diffMs < 0) {
          // Never show future absolute dates on cards; treat as just-published.
          return "Just now";
        }
        const diffMinutes = Math.floor(diffMs / 60000);
        if (diffMinutes < 60) {
          const m = Math.max(1, diffMinutes);
          return m + (m === 1 ? " min ago" : " mins ago");
        }
        const diffHours = Math.floor(diffMinutes / 60);
        if (diffHours < 24) {
          return diffHours + (diffHours === 1 ? " hour ago" : " hours ago");
        }
        try {
          return new Intl.DateTimeFormat("en-US", {
            month: "short",
            day: "numeric",
            hour: "numeric",
            minute: "2-digit",
            hour12: true
          }).format(d);
        } catch (_) {
          return "";
        }
      }

      function loadLocalToggleState() {
        try {
          const raw = localStorage.getItem(localToggleStorageKey);
          if (!raw) return {};
          const parsed = JSON.parse(raw);
          return parsed && typeof parsed === "object" ? parsed : {};
        } catch (_) {
          return {};
        }
      }

      function saveLocalToggleState() {
        try {
          localStorage.setItem(localToggleStorageKey, JSON.stringify(localHideState));
        } catch (_) {}
      }

      function shouldHideByLocalPreset(script) {
        const blob = normalizeText(String(script?.title || ""));
        if (!blob) return false;
        return localHidePresets.some((preset) => {
          if (localHideState[preset.id] !== true) return false;
          return preset.tokens.some((token) => blob.includes(normalizeText(token)));
        });
      }

      function renderKeywordToggles() {
        const bar = document.getElementById("keyword-toggle-bar");
        if (!bar) return;
        bar.innerHTML = localHidePresets.map((preset) => {
          const active = localHideState[preset.id] === true;
          const mark = active ? "☑" : "☐";
          const labelHtml = preset.labelHtml ? preset.labelHtml : escapeHtml(preset.label);
          return `<button class="keyword-toggle${active ? " active" : ""}" type="button" data-preset-id="${escapeHtml(preset.id)}"><span class="toggle-mark">${mark}</span><span class="toggle-icon">⛔</span>${labelHtml}</button>`;
        }).join("");
        bar.style.display = filterMode === "all" ? "flex" : "none";
      }

      localHideState = loadLocalToggleState();

      function buildCard(script) {
        const title = escapeHtml(script?.title || "Untitled Script");
        const slug = script?.slug || "";
        const tags = escapeHtml(Array.isArray(script?.tags) ? script.tags.slice(0, 3).join(", ") : "No tags");
        const trusted = script?.trusted === true;
        const views = Number.isFinite(script?.views) ? script.views.toLocaleString() : "-";
        const href = escapeHtml(slug ? "https://scriptblox.com/script/" + encodeURIComponent(slug) : "https://scriptblox.com");
        const image = escapeHtml(resolveImage(script));
        const postTime = escapeHtml(formatPostTime(script?.createdAt));

        return `
          <a class="card card-link" href="${href}" target="_blank" rel="noopener noreferrer">
            <div class="thumb-wrap">
              <img src="${image}" alt="${title}" loading="lazy" onerror="this.onerror=null;this.src='${fallbackImage}'">
              <span class="view-chip">👁 ${views}</span>
            </div>
            <h3>${title}</h3>
            ${(trusted || postTime) ? `<p class="meta">${trusted ? `<span class="trusted-badge">Trusted ✔</span>` : `<span></span>`}${postTime ? `<span class="post-time">${postTime}</span>` : ""}</p>` : ""}
            <p>${tags}</p>
          </a>
        `;
      }

      function renderPage() {
        const feed = document.getElementById("script-feed");
        const pageText = document.getElementById("page-text");
        const prev = document.getElementById("prev-page");
        const next = document.getElementById("next-page");
        const jumpWrap = document.getElementById("page-jump");
        const slider = document.getElementById("page-slider");
        const input = document.getElementById("page-input");
        if (filterMode === "trustedUsers") {
          const users = [];
          const seen = new Set();
          allScripts.forEach((s) => {
            const u = resolveOwnerUsername(s);
            if (!u) return;
            if (s?.trustedByUser !== true) return;
            const k = u.toLowerCase();
            if (seen.has(k)) return;
            seen.add(k);
            users.push({
              username: u,
              profilePicture: s?.ownerProfilePicture || "",
              profileUrl: "https://scriptblox.com/user/" + encodeURIComponent(u)
            });
          });
          seedTrustedUsers.forEach((u) => {
            const k = String(u).toLowerCase();
            if (seen.has(k)) return;
            seen.add(k);
            users.push({
              username: u,
              profilePicture: "",
              profileUrl: "https://scriptblox.com/user/" + encodeURIComponent(u)
            });
          });

          const q = searchQuery.trim().toLowerCase();
          const visibleUsers = q ? users.filter((u) => u.username.toLowerCase().includes(q)) : users;
          feed.innerHTML = visibleUsers.map((u) => {
            const name = escapeHtml(u.username);
            const pfp = escapeHtml(u.profilePicture || ("https://api.dicebear.com/9.x/identicon/svg?seed=" + encodeURIComponent(u.username)));
            const href = escapeHtml(u.profileUrl);
            return `
              <a class="trusted-user-card" href="${href}" target="_blank" rel="noopener noreferrer">
                <div class="trusted-user-head">
                  <img class="trusted-user-pfp" src="${pfp}" alt="${name}" loading="lazy">
                  <div>
                    <p class="trusted-user-name">@${name}</p>
                    <p class="trusted-user-sub">Trusted creator • Open ScriptBlox profile</p>
                  </div>
                </div>
              </a>
            `;
          }).join("");
          pageText.textContent = "Trusted Users: " + visibleUsers.length;
          prev.disabled = true;
          next.disabled = true;
          jumpWrap.style.display = "none";
          return;
        }

        const total = Math.max(1, Math.ceil(visibleScripts.length / perPage));
        if (page > total) page = total;

        const start = (page - 1) * perPage;
        const items = visibleScripts.slice(start, start + perPage);
        feed.innerHTML = items.map(buildCard).join("");

        pageText.textContent = "Page " + page + " / " + total;
        prev.disabled = page <= 1;
        next.disabled = page >= total;
        jumpWrap.style.display = "flex";
        slider.max = String(total);
        slider.value = String(page);
        input.max = String(total);
        input.value = String(page);
      }

      function applyTabs() {
        const q = searchQuery.trim().toLowerCase();
        visibleScripts = allScripts.filter((s) => {
          if (!s) return false;
          const trusted = s.trusted === true;
          const trending = s.trending === true;
          const title = String(s.title || "").toLowerCase();
          const tags = Array.isArray(s.tags) ? s.tags.join(" ").toLowerCase() : "";
          const matchesSearch = !q || title.includes(q) || tags.includes(q);
          const localAllowed = filterMode !== "all" || !shouldHideByLocalPreset(s);
          const matchesMode =
            filterMode === "all" ||
            (filterMode === "recommend" && trusted) ||
            (filterMode === "trending" && trending);
          return matchesMode && matchesSearch && localAllowed;
        });
        page = 1;
        renderKeywordToggles();
        renderPage();
      }

      function setActiveTab() {
        document.getElementById("tab-all").classList.toggle("active", filterMode === "all");
        document.getElementById("tab-recommend").classList.toggle("active", filterMode === "recommend");
        document.getElementById("tab-trusted-users").classList.toggle("active", filterMode === "trustedUsers");
        document.getElementById("tab-trending").classList.toggle("active", filterMode === "trending");
        renderKeywordToggles();
      }

      function statusPhrase(filteredCount) {
        if (filteredCount <= 0) {
          return "Library synced. Fresh scripts ready.";
        }
        const templates = [
          "Blocked {n} scam posts. Feed cleaned and safe.",
          "Shield active: filtered {n} suspicious posts.",
          "Anti-scammer removed {n} risky posts for you.",
          "Clean sweep complete: {n} scam posts blocked.",
          "Protection pass done. {n} scammy posts hidden."
        ];
        const pick = templates[Math.floor(Math.random() * templates.length)];
        return pick.replace("{n}", String(filteredCount));
      }

      async function fetchJson(url) {
        const res = await fetch(url, { method: "GET", cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        return res.json();
      }

      async function loadScripts() {
        if (loadingFeed) return;
        loadingFeed = true;
        const status = document.getElementById("feed-status");
        try {
          try {
            const cacheBust = "v=" + Date.now();
            const payload = await fetchJson("scriptblox-feed.json?" + cacheBust);
            const scripts = payload?.scripts || [];
            if (scripts.length) {
              const filtered = Number(payload?.moderation?.filteredCount || 0);
              status.textContent = statusPhrase(filtered);
              allScripts = scripts;
              applyTabs();
              return;
            }
          } catch (_) {
            // Fallback below.
          }

          const inlineFeed = window.SCRIPTBLOX_FEED;
          if (inlineFeed && Array.isArray(inlineFeed.scripts) && inlineFeed.scripts.length) {
            const filtered = Number(inlineFeed?.moderation?.filteredCount || 0);
            status.textContent = statusPhrase(filtered);
            allScripts = inlineFeed.scripts;
            applyTabs();
          } else {
            status.textContent = "No feed data yet. Run refresh-scriptblox-feed.ps1 and reload.";
            document.getElementById("script-feed").innerHTML = "";
          }
        } finally {
          loadingFeed = false;
        }
      }

      document.getElementById("prev-page").addEventListener("click", function () {
        if (page > 1) {
          page -= 1;
          renderPage();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });

      document.getElementById("next-page").addEventListener("click", function () {
        const total = Math.max(1, Math.ceil(visibleScripts.length / perPage));
        if (page < total) {
          page += 1;
          renderPage();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });
      document.getElementById("page-slider").addEventListener("input", function (e) {
        const total = Math.max(1, Math.ceil(visibleScripts.length / perPage));
        const next = Math.max(1, Math.min(total, parseInt(e.target.value || "1", 10)));
        page = next;
        renderPage();
      });
      document.getElementById("go-page").addEventListener("click", function () {
        const total = Math.max(1, Math.ceil(visibleScripts.length / perPage));
        const raw = document.getElementById("page-input").value;
        const next = Math.max(1, Math.min(total, parseInt(raw || "1", 10)));
        page = Number.isFinite(next) ? next : 1;
        renderPage();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
      document.getElementById("page-input").addEventListener("keydown", function (e) {
        if (e.key !== "Enter") return;
        e.preventDefault();
        document.getElementById("go-page").click();
      });

      document.getElementById("tab-all").addEventListener("click", function () {
        filterMode = "all";
        setActiveTab();
        applyTabs();
      });
      document.getElementById("tab-recommend").addEventListener("click", function () {
        filterMode = "recommend";
        setActiveTab();
        applyTabs();
      });
      document.getElementById("tab-trusted-users").addEventListener("click", function () {
        filterMode = "trustedUsers";
        setActiveTab();
        renderPage();
      });
      document.getElementById("tab-trending").addEventListener("click", function () {
        filterMode = "trending";
        setActiveTab();
        applyTabs();
      });
      document.getElementById("search-input").addEventListener("input", function (e) {
        searchQuery = String(e.target.value || "");
        if (filterMode === "trustedUsers") {
          renderPage();
        } else {
          applyTabs();
        }
      });
      document.getElementById("copy-discord").addEventListener("click", async function () {
        const btn = this;
        try {
          await navigator.clipboard.writeText("Jadin7380");
          btn.textContent = "Discord Copied: Jadin7380";
          setTimeout(() => { btn.textContent = "DM for Trusted/Recommended Access"; }, 1200);
        } catch (_) {
          btn.textContent = "Discord: Jadin7380";
          setTimeout(() => { btn.textContent = "DM for Trusted/Recommended Access"; }, 1200);
        }
      });
      document.getElementById("keyword-toggle-bar").addEventListener("click", function (e) {
        const btn = e.target.closest("button[data-preset-id]");
        if (!btn) return;
        const id = String(btn.getAttribute("data-preset-id") || "");
        if (!id) return;
        localHideState[id] = !(localHideState[id] === true);
        saveLocalToggleState();
        renderKeywordToggles();
        applyTabs();
      });

      (function () {
        const helpBtn = document.getElementById("open-help");
        const helpModal = document.getElementById("help-modal");
        const closeHelp = document.getElementById("close-help");
        if (!helpBtn) return;
        helpBtn.addEventListener("click", function (e) {
          e.preventDefault();
          helpModal.classList.add("open");
          helpModal.setAttribute("aria-hidden", "false");
        });
        closeHelp.addEventListener("click", function () {
          helpModal.classList.remove("open");
          helpModal.setAttribute("aria-hidden", "true");
        });
        helpModal.addEventListener("click", function (e) {
          if (e.target === helpModal) closeHelp.click();
        });
      })();

      (function () {
        const openBtn = document.getElementById("open-settings");
        const closeBtn = document.getElementById("close-settings");
        const modal = document.getElementById("settings-modal");
        const grid = document.getElementById("theme-grid");
        const soundGrid = document.getElementById("sound-grid");
        const volumeSlider = document.getElementById("sound-volume");
        const volumeValue = document.getElementById("sound-volume-value");
        const tm = window.ThemeManager;
        const sm = window.UISounds;
        if (!tm) return;

        function setActive(id) {
          grid.querySelectorAll(".theme-btn").forEach((el) => {
            el.classList.toggle("active", el.getAttribute("data-theme-id") === id);
          });
        }
        function swatch(vars) {
          return `linear-gradient(135deg, ${vars["--bg1"]}, ${vars["--bg2"]})`;
        }

        Object.keys(tm.themes).forEach((id) => {
          const t = tm.themes[id];
          const b = document.createElement("button");
          b.type = "button";
          b.className = "theme-btn";
          b.setAttribute("data-theme-id", id);
          b.innerHTML = `<div class="theme-swatch" style="background:${swatch(t.vars)}"></div><div class="theme-name">${t.label}</div>`;
          b.addEventListener("click", () => {
            tm.applyTheme(id);
            setActive(id);
          });
          grid.appendChild(b);
        });
        setActive(tm.getCurrentTheme());

        if (sm && soundGrid) {
          function setSoundActive(id) {
            soundGrid.querySelectorAll(".sound-btn").forEach((el) => {
              el.classList.toggle("active", el.getAttribute("data-sound-id") === id);
            });
          }
          sm.listPresets().forEach((p) => {
            const b = document.createElement("button");
            b.type = "button";
            b.className = "sound-btn";
            b.setAttribute("data-sound-id", p.id);
            b.textContent = p.label;
            b.addEventListener("click", () => {
              sm.setPreset(p.id);
              setSoundActive(p.id);
            });
            soundGrid.appendChild(b);
          });
          setSoundActive(sm.getPreset());
          if (volumeSlider && volumeValue && sm.getMasterVolume) {
            const startVol = Math.round(sm.getMasterVolume() * 100);
            volumeSlider.value = String(startVol);
            volumeValue.textContent = startVol + "%";
            volumeSlider.addEventListener("input", () => {
              const next = Math.max(0, Math.min(100, parseInt(volumeSlider.value || "0", 10)));
              if (sm.setMasterVolume) sm.setMasterVolume(next / 100);
              volumeValue.textContent = next + "%";
            });
          }
        }

        openBtn.addEventListener("click", (e) => {
          e.preventDefault();
          modal.classList.add("open");
          modal.setAttribute("aria-hidden", "false");
        });
        closeBtn.addEventListener("click", () => {
          modal.classList.remove("open");
          modal.setAttribute("aria-hidden", "true");
        });
        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeBtn.click();
        });
      })();

      setActiveTab();
      loadScripts();
    </script>
  </body>
</html>






